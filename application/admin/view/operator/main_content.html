<!-- å·¦è¾¹ç»Ÿè®¡ -->
 <style>
    .table-export-select{
        border: none !important;
    }
 </style>
<div class="col-md-8">
    <div class="row g-3">
        <div class="col-md-6">
            <div class="wukong-table-card fold-card export">
                <div class="wukong-table-card-header">
                    <span>ä¸šåŠ¡è¯¢ç›˜æ’è¡Œ</span>
                    <button class="btn btn-sm btn-outline-secondary toggle-table" style="display: none;">å±•å¼€</button>
                </div>
                <div class="filter-bar">
                    <label>å›¢é˜Ÿç­›é€‰ï¼š</label>
                    <select id="yw_team_filter" lay-filter="yw_team_filter" class="form-select" style="width: 150px;">
                        <option value="">å…¨éƒ¨å›¢é˜Ÿ</option>
                        {volist name="$data['yw_data']['total']" id='vo'}
                        <option value="{$vo['team_name']}">{$vo['team_name']}</option>
                        {/volist}
                    </select>
                    <div class="total">åˆè®¡ï¼š<span>{$data['yw_data']['list']|array_column='yw_num'|array_sum}</span></div>
                </div>
                <div class="wukong-table-card-body table-scroll" style="max-height: 400px; overflow-y: auto;">
                    <table id="yw_list_table" class="wukong-table fold-table">
                        <thead>
                            <tr>
                                <th>ä¸šåŠ¡å‘˜</th>
                                <th>è¯¢ç›˜æ•°é‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            {volist name="$data['yw_data']['list']" id='vo'}
                            <tr>
                                <td><strong>{$vo['username']}</strong> ({$vo['team_name']})</td>
                                <td>{$vo['yw_num']}</td>
                            </tr>
                            {/volist}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="wukong-table-card export">
                <div class="wukong-table-card-header">ä¸šåŠ¡è¯¢ç›˜æ±‡æ€»</div>
                <div class="filter-bar">
                    <div><a href="javascript:void(0);" class="detail-link text-primary text-decoration-none" data-url="{:url('getDetail')}" data-type="yw-total">æŸ¥çœ‹è¯¦æƒ…</a></div>
                    <div class="total">åˆè®¡ï¼š<span>{$data['yw_data']['total']|array_column='yw_num'|array_sum}</span></div>
                </div>
                <div class="wukong-table-card-body">
                    <table id="yw_total_table" class="wukong-table">
                        <thead>
                            <tr>
                                <th>å›¢é˜Ÿ</th>
                                <th>è¯¢ç›˜æ•°é‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            {volist name="$data['yw_data']['total']" id='vo' key="k" }
                            <tr>
                                <td><strong>{$vo['team_name']}</strong></td>
                                <td>{$vo['yw_num']}</td>
                            </tr>
                            {/volist}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="row g-3">
        <div class="col-md-6">
            <div class="wukong-table-card fold-card export">
                <div class="wukong-table-card-header">
                    <span>è¿è¥è¯¢ç›˜æ’è¡Œ</span>
                    <button class="btn btn-sm btn-outline-secondary toggle-table" style="display: none;">å±•å¼€</button>
                </div>
                <div class="filter-bar">
                    <label>å›¢é˜Ÿç­›é€‰ï¼š</label>
                    <select id="yy_team_filter" lay-filter="yy_team_filter" class="form-select" style="width: 150px;">
                        <option value="">å…¨éƒ¨å›¢é˜Ÿ</option>
                        {volist name="$data['yy_data']['total']" id='vo'}
                        <option value="{$vo['team_name']}">{$vo['team_name']}</option>
                        {/volist}
                    </select>
                    <div class="total">åˆè®¡ï¼š<span>{$data['yy_data']['list']|array_column='yy_num'|array_sum}</span></div>
                </div>
                <div class="wukong-table-card-body table-scroll" style="max-height: 400px; overflow-y: auto;">
                    <table id="yy_list_table" class="wukong-table fold-table">
                        <thead>
                            <tr>
                                <th>è¿è¥</th>
                                <th>è¯¢ç›˜æ•°é‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            {volist name="$data['yy_data']['list']" id='vo'}
                            <tr>
                                <td><strong>{$vo['username']}</strong> ({$vo['channel']})</td>
                                <td>{$vo['yy_num']}</td>
                            </tr>
                            {/volist}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="wukong-table-card export">
                <div class="wukong-table-card-header">è¿è¥è¯¢ç›˜æ±‡æ€»</div>
                <div class="filter-bar">
                    <div class="total">åˆè®¡ï¼š<span>{$data['yy_data']['total']|array_column='yy_num'|array_sum}</span></div>
                </div>
                <div class="wukong-table-card-body">
                    <table id="yy_total_table" class="wukong-table">
                        <thead>
                            <tr>
                                <th>å›¢é˜Ÿ</th>
                                <th>è¯¢ç›˜æ•°é‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            {volist name="$data['yy_data']['total']" id='vo'}
                            <tr>
                                <td><strong>{$vo['team_name']}</strong></td>
                                <td>{$vo['yy_num']}</td>
                            </tr>
                            {/volist}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="row g-3">
        <div class="col-md-6">
            <div class="wukong-table-card export">
                <div class="wukong-table-card-header">é”€å”®äº§å“æ’è¡Œ</div>
                <div class="wukong-table-card-body">
                    <table id="sp_list_table" class="wukong-table" data-url="getProdAll" data-params='{"data":{"type":"order"},"ele":["#at_time","#dateRange"]}'>
                        <thead>
                            <tr>
                                <th>äº§å“</th>
                                <th>é”€å”®æ•°é‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            {volist name="$data['product_data']['order_prod']" id='vo'}
                            <tr>
                                <td>{$vo['product_name']}</td>
                                <td>{$vo['count']}</td>
                            </tr>
                            {/volist}
                            {if !$data['product_data']['order_prod']}<tr>
                                <td colspan="2" class="text-center text-muted">æš‚æ— æ•°æ®</td>
                            </tr>{/if}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="wukong-table-card export">
                <div class="wukong-table-card-header">è¯¢ç›˜äº§å“æ’è¡Œ</div>
                <div class="wukong-table-card-body">
                    <table id="pd_list_table" class="wukong-table" data-url="getProdAll" data-params='{"data":{"type":"oper"},"ele":["#at_time","#dateRange"]}'>
                        <thead>
                            <tr>
                                <th>äº§å“</th>
                                <th>è¯¢ç›˜æ•°é‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            {volist name="$data['product_data']['oper_prod']" id='vo'}
                            <tr>
                                <td>{$vo['product_name']}</td>
                                <td>{$vo['count']}</td>
                            </tr>
                            {/volist}
                            {if !$data['product_data']['oper_prod']}<tr>
                                <td colspan="2" class="text-center text-muted">æš‚æ— æ•°æ®</td>
                            </tr>{/if}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="row g-3">
        <div class="col-12">
            <div class="wukong-table-card export">
                <div class="wukong-table-card-header">æ€»è¯¢ç›˜ç»Ÿè®¡</div>
                <div class="filter-bar">
                    <div class="total">åˆè®¡ï¼š<span>{$data['total_inquiry_stats']|array_column='count'|array_sum}</span></div>
                </div>
                <div class="wukong-table-card-body">
                    <table id="total_inquiry_table" class="wukong-table">
                        <thead>
                            <tr>
                                <th>æ¸ é“</th>
                                <th>ç«¯å£</th>
                                <th>è¯¢ç›˜æ•°é‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            {volist name="$data['total_inquiry_stats']" id='vo'}
                            <tr>
                                <td>{$vo['channel_name']}</td>
                                <td>{$vo['port_name'] ? $vo['port_name'] : '-'}</td>
                                <td>{$vo['count']}</td>
                            </tr>
                            {/volist}
                            {if !$data['total_inquiry_stats']}<tr>
                                <td colspan="3" class="text-center text-muted">æš‚æ— æ•°æ®</td>
                            </tr>{/if}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- å³è¾¹å¾…åŠ + åŠ¨æ€ -->
<div class="col-md-4">
    <div class="wukong-todo-card">
        <div class="wukong-todo-card-header">{$wenhou}</div>
        <div class="wukong-todo-card-body">
            <p class="mb-0">æ¬¢è¿å›æ¥ï¼ç¥ä½ å·¥ä½œé¡ºåˆ© ğŸ‘</p>
        </div>
    </div>

    <div class="wukong-table-card">
        <div class="wukong-table-card-header">å¾…åŠäº‹é¡¹</div>
        <div class="wukong-table-card-body">
            <table class="wukong-table">
                <tbody>
                    <tr>
                        <td><strong>ä»Šæ—¥å·²è·Ÿè¿›</strong></td>
                        <td class="text-primary"><strong>{$today_count}</strong></td>
                    </tr>
                    <tr>
                        <td><strong>æœªè·Ÿè¿›ä¸ªæ•°</strong></td>
                        <td class="text-warning"><strong>{$all_count}</strong></td>
                    </tr>
                    <tr>
                        <td><strong>è·Ÿè¿›ç‡</strong></td>
                        <td class="text-success"><strong>{$genjinlv}%</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="wukong-table-card">
        <div class="wukong-table-card-header">æœ€è¿‘åŠ¨æ€</div>
        <div class="wukong-table-card-body">
            <ul class="wukong-timeline">
                {volist name='result' id='vo'}
                <li class="wukong-timeline-item">
                    <img src="{$vo.avatar}" class="wukong-timeline-avatar" alt="{$vo.username}">
                    <div class="wukong-timeline-content">
                        <p>
                            <span class="wukong-timeline-username">{$vo.username}</span>
                            <span class="wukong-timeline-action">è·Ÿè¿›</span>
                            <a href="{:url('Client/dialogue')}?id={$vo.id}" class="wukong-timeline-link">{$vo.kh_name}</a>
                        </p>
                        <p class="wukong-timeline-msg">
                            <strong style="color: #d4a574;">è®°å½•:</strong> {$vo.reply_msg}
                        </p>
                        <span class="wukong-timeline-time">æ—¶é—´ï¼š{$vo.create_date|date='Y-m-d H:i:s'}</span>
                    </div>
                </li>
                {/volist}
            </ul>
        </div>
    </div>
</div>

<!-- è¯¦æƒ…å¼¹çª— -->
<div id="detailModal" style="display: none; padding: 20px;">
    <div class="row">
        <div class="col-12">
            <div class="wukong-table-card">
                <div class="wukong-table-card-header">
                    <span id="modalTitle">äº¤å‰ç»Ÿè®¡è¡¨</span>
                    <button class="btn btn-sm btn-primary wukong-btn wukong-btn-primary" onclick="exportCrossTable()">å¯¼å‡ºè¡¨æ ¼</button>
                </div>
                <div class="wukong-table-card-body">
                    <div id="crossTableContainer" style="overflow-x: auto;">
                        <!-- è¡¨æ ¼å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    function initFoldCard() {
        $('.fold-card').each(function () {
            var $card = $(this);
            var $header = $card.find('.wukong-table-card-header');
            var $scroll = $card.find('.table-scroll');
            if ($scroll.length && $scroll[0].scrollHeight > $scroll.height() + 20) {
                var $toggleBtn = $header.find('.toggle-table');
                if ($toggleBtn.length === 0) {
                    $header.append('<button class="btn btn-sm btn-outline-secondary toggle-table">å±•å¼€</button>');
                } else {
                    $toggleBtn.show();
                }
            } else {
                $header.find('.toggle-table').hide();
            }
        });
    }
    // é¡µé¢åˆå§‹åŒ–æ—¶è¿è¡Œä¸€æ¬¡
    $(document).ready(function() {
        // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿ DOM å®Œå…¨åŠ è½½
        setTimeout(function() {
            initFoldCard();
            if (typeof ExportSelectTables !== 'undefined') {
                ExportSelectTables.addCheckboxes();
            }
        }, 100);
    });

    function init(){
        initFoldCard();
        if (typeof ExportSelectTables !== 'undefined') {
            ExportSelectTables.addCheckboxes();
        }
    }
</script>
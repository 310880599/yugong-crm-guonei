{include file="common/head"/}
<style>
    .main-content {
        padding: 20px;
    }

    .password-form {
        max-width: 500px;
        margin: 0 auto;
    }

    .form-title {
        text-align: center;
        margin-bottom: 30px;
    }
</style>
<link rel="stylesheet" type="text/css" href="/static/admin/css/admin.css" />

<div class="admin-main layui-anim layui-anim-upbit">
    <div class="password-form">
        <h2 class="form-title">修改密码</h2>
        <form class="layui-form" lay-filter="passwordForm">
            <div class="layui-form-item">
                <label class="layui-form-label">当前密码</label>
                <div class="layui-input-block">
                    <input type="password" name="old_password" required lay-verify="required" placeholder="请输入当前密码"
                        autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">新密码</label>
                <div class="layui-input-block">
                    <input type="password" name="new_password" required lay-verify="required|min:6"
                        placeholder="请输入新密码（至少6位）" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">确认新密码</label>
                <div class="layui-input-block">
                    <input type="password" name="confirm_password" required lay-verify="required|confirmPassword"
                        placeholder="请再次输入新密码" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit lay-filter="submitModify">保存修改</button>
                    <button type="button" class="layui-btn layui-btn-primary" onclick="history.back()">取消</button>
                </div>
            </div>
        </form>
    </div>
</div>
{include file="common/foot"/}
<script>
    layui.use(['form', 'layer'], function () {
        var form = layui.form;
        var layer = layui.layer;

        // 自定义验证规则
        form.verify({
            confirmPassword: function (value) {
                var newPassword = document.getElementsByName('new_password')[0].value;
                if (value !== newPassword) {
                    return '两次输入的密码不一致！';
                }
            }
        });

        // 监听表单提交
        form.on('submit(submitModify)', function (data) {
            // 这里是AJAX提交逻辑
            $.ajax({
                url: '/admin/index/editPasswd',
                type: 'post',
                data: data.field,
                dataType: 'json',
                success: function (res) {
                    if (res.code === 1) {
                        layer.msg('密码修改成功，请重新登录', { icon: 1, time: 2000 }, function () {
                            // 跳转到登录页或刷新页面
                            window.location.href = '/admin/login';
                        });
                    } else {
                        layer.msg(res.msg || '修改失败，请重试', { icon: 2 });
                    }
                },
                error: function () {
                    layer.msg('网络错误，请稍后重试', { icon: 2 });
                }
            });
            return false; // 阻止表单默认提交
        });
    });
</script>
</body>

</html>